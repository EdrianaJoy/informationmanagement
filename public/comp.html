<!DOCTYPE html>
<html lang="en">

<head>
    <title>Application Form - KERA Telecommunications</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/apply.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {

            loadFormData('company-info-form'); //-- load form data when the page loads

            $('#company-info-form').on('input', function () {
                saveFormData('company-info-form'); //-- save form data on input change
            });

            function handleNavigation($link) {
                $link.click(function (e) {
                    e.preventDefault();
                    $('nav ul li a').removeClass('active-link');
                    $link.addClass('active-link');
                    window.location.href = $link.attr('href');
                });
            }
            handleNavigation($('#apply-link'));
            handleNavigation($('#admin-link'));
            handleNavigation($('#about-link'));
        });

        //-- function save form data to session storage
        function saveFormData(formId) {
            const form = document.getElementById(formId);
            const formData = new FormData(form);
            formData.forEach((value, key) => {
                sessionStorage.setItem(key, value);
            });
        }

        //-- function load form data from session storage
        function loadFormData(formId) {
            const form = document.getElementById(formId);
            Array.from(form.elements).forEach((element) => {
                if (element.name) {
                    element.value = sessionStorage.getItem(element.name) || '';
                }
            });
        }

        //-- NEW: manual storage of form data for data fetching/retrieval 
        function storeFormData(page) {
            const formData = {} 
            formData.comp_name_1 = document.getElementID('comp_name_1').value;
            formData.doy_1 = document.getElementID('doy_1').value;
            formData.pos_comp_1 = document.getElementID('pos_comp_1').value;
            formData.comp_name_2 = document.getElementID('comp_name_2').value;
            formData.doy_2 = document.getElementID('doy_2').value;
            formData.pos_comp_2 = document.getElementID('pos_comp_2').value;
            formData.comp_name_3 = document.getElementID('comp_name_3').value;
            formData.doy_3 = document.getElementID('doy_3').value;
            formData.pos_comp_3 = document.getElementID('pos_comp_3').value;

            sessionStorage.setItem(`formPage${page}`, JSON.stringify(formData));
        }

        //-- function to validate if all required fields have input
        function validateForm(event) {
            event.preventDefault(); //-- prevent form submission
            const form = document.getElementById('company-info-form');

            if (form.checkValidity()) {
                storeFormData(4); //-- NEW: function call for manual storage
                saveFormData('company-info-form'); //-- save form data
                window.location.href = 'skills.html'; //-- navigate to the next page
            } else {
                form.reportValidity();
            }
        }

        //-- function to navigate back to prev page
        function navigateToPrevPage(e) {
            e.preventDefault(); //-- prevent form submission
            saveFormData('company-info-form'); //-- save form data
            window.location.href = 'school.html'; //-- navigate back to the prev page
        }
    </script>

</head>

<body>
    <header>
        <div class="logo">
            <a href="front.html">
                <img src="images/logo.png" alt="KERA Telecommunications Logo">
            </a>
        </div>
        <nav>
            <ul>
                <li><a id="apply-link" href="perso_info.html">Apply Now</a></li>
                <li><a id="admin-link" href="admin.html">Admin</a></li>
                <li><a id="about-link" href="about.html">About</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="hero">
            <div class="appli">
                <form id="company-info-form"> 
                    <div class="form-one">
                        <label for="comp_name_1">Company Name:</label>
                        <input type="text" id="comp_name_1" name="comp_name_1" placeholder="Previous Company Name" required>
                    </div>
                    <div class="form-one">
                        <label for="doy_1">Duration of Year:</label>
                        <input type="text" id="doy_1" name="doy_1" placeholder="YYYY-YYYY" required>
                    </div>
                    <div class="form-one">
                        <label for="pos_comp_1">Position in the Company:</label>
                        <input type="text" id="pos_comp_1" name="pos_comp_1" placeholder="Previous Position" required>
                    </div>
                    <div class="form-one">
                        <label for="comp_name_2">Company Name (Optional):</label>
                        <input type="text" id="comp_name_2" name="comp_name_2" placeholder="Previous Company Name">
                    </div>
                    <div class="form-one">
                        <label for="doy_2">Duration of Year:</label>
                        <input type="text" id="doy_2" name="doy_2" placeholder="YYYY-YYYY">
                    </div>
                    <div class="form-one">
                        <label for="pos_comp_2">Position in the Company:</label>
                        <input type="text" id="pos_comp_2" name="pos_comp_2" placeholder="Previous Position">
                    </div>
                    <div class="form-one">
                        <label for="comp_name_3">Company Name (Optional):</label>
                        <input type="text" id="comp_name_3" name="comp_name_3" placeholder="Previous Company Name">
                    </div>
                    <div class="form-one">
                        <label for="doy_3">Duration of Year:</label>
                        <input type="text" id="doy_3" name="doy_3" placeholder="YYYY-YYYY">
                    </div>
                    <div class="form-one">
                        <label for="pos_comp_3">Position in the Company:</label>
                        <input type="text" id="pos_comp_3" name="pos_comp_3" placeholder="Previous Position">
                    </div>
                    <div class="navigationtwo">
                        <button class="apply-button" onclick="navigateToPrevPage(event)">Previous</button>
                    </div>
                    <div class="navigation">
                        <button class="apply-button" onclick="validateForm(event)">Next</button>
                    </div>
                </form>
        </section>
    </main>
    <script src = 'public\sendReq.js'></script> <!-- NEW: sendReq.js script linking -->
</body>

</html>